<!-- ##########################################################################
#
#   Copyright (c) 2018-Present INFINIT-PLUS CIA. LTDA. (<https://www.infinit-plus.com/>)
#   See LICENSE file for full copyright and licensing details.
#   "License URL : <https://www.infinit-plus.com/license.html/>"
#
########################################################################## -->
<odoo>
    <template id="portal_my_home_menu_buss_users" name="Portal layout : business users menu" inherit_id="portal.portal_breadcrumbs" priority="30">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li class="breadcrumb-item active">
                Business users
            </li>
        </xpath>
    </template>

    <template id="portal_my_home_business_users" name="Portal My Home : transaction entries" inherit_id="portal.portal_my_home" priority="30">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <!--
                        <t t-if="business_users_count" t-call="portal.portal_docs_entry">
                            <t t-set="title">Business users</t>
                            <t t-set="url" t-value="'/my/business/users'"/>
                            <t t-set="count" t-value="business_users_count"/>
                        </t>
            -->
            <t t-foreach="request.env.user.get_portal_business_menu()" t-as="menu">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="title" t-value="menu['name']"/>
                    <t t-set="url" t-value="menu['portal_url'] + '?maids=' + menu['maids']"/>
                    <!--                <t t-set="count" t-value="business_users_count"/>-->
                </t>
            </t>
        </xpath>
    </template>

    <template id="portal_my_business_users" name="Business users">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Business users</t>
            </t>
            <t t-set="group_categ" t-value="request.env['ir.module.category'].sudo().search([('name', '=', 'Business')])"/>
            <t t-set="user_groups" t-value="request.env['res.groups'].sudo().search([('category_id', '=', group_categ.id)])"/>
            <div class="w-100 text-right" t-if="access_rights.get('create')">
                <a href="/my/business/users/manager" class="btn btn-primary">
                    Create user
                </a>
            </div>
            <t t-if="not users">
                <p>There are currently no users for this business.</p>
            </t>
            <t t-if="users" t-call="portal.portal_table">
                <thead>
                    <tr class="active">
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Creation date</th>
                        <th>State</th>
                        <th t-if="access_rights.get('write')">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="users" t-as="user">
                        <tr id="users">
                            <td>
                                <t t-esc="user.name"/>
                            </td>
                            <td>
                                <t t-esc="user.login"/>
                            </td>
                            <td>
                                <t t-foreach="user_groups" t-as="group">
                                    <t t-esc="group.name" t-if="group.id in user.groups_id.ids"/>
                                </t>
                            </td>
                            <td><span t-field="user.create_date" t-options='{"format": "dd/MM/yyyy"}'/></td>
                            <td>
                                <div t-att-id="user.id" class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" t-att-id="'userState-'+str(user.id)" t-att-checked="user.active"
                                    t-att-disabled="not access_rights.get('write')"/>
                                    <label class="custom-control-label" t-att-for="'userState-'+str(user.id)"></label>
                                </div>
                            </td>
                            <td t-if="access_rights.get('write')">
                                <a class="mx-1" t-att-href="'/my/business/users/manager/' + str(user.id) + '?maids=' + maids">
                                    <i class="fa fa-pencil"/>
                                </a>
                            </td>
                        </tr>
                    </t>
                </tbody>
            </t>
        </t>
        <div class="modal" id="confirmDeactivationModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeactivationModal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span>&#xD7;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this user?
                    </div>
                    <div class="modal-footer">
                        <a id="confirmDeactivation" class="btn btn-primary" data-dismiss="modal">Accept</a>
                        <a class="btn btn-secondary" data-dismiss="modal">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal" id="loader" tabindex="-1" role="dialog" aria-labelledby="loaderLabel">
            <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
                <div class="w-100">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
</odoo>